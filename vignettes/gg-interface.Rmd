---
title: "GG interface"
author: "Angus Moore"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{gg-interface}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette details the `ggplot2`-like interface that can be used to build `arphit` graphs. It assumes some familiarity with the way `ggplot2` graphs are constructed. It also assumes you are familiar with `arphit`'s basic options and layouts. If not, read the plotting options vignette (in particular the first section).

The `ggplot2`-like interface for `arphit` is referred to as `agg` throughout (and in function names).

# Basics

## Starting off

The first part of creating an `arphit` ggplot-like graph is to create one and define the layout:
```{r, results = "hide"}
library(arphit)
p <- arphitgg(layout = "1")
```
(If omitted, `layout` defaults to "1".)

Here we are assigning the graph to the variable `p`. Graphs are then created by adding layers and other elements (such as titles). These are added using the `+` operator. To _show_ the graph, we call `agg_draw(p)`. Alternatively, if you are working interactively, you can simply type `p` (or whatever you have assigned your graph to) at the console to display it.

`arphitgg` can optionally take a `data` and `aes` (short for aesthetic) argument. These provide defaults that layers will inherit if the layer does not specify its own. This is very useful when you have a single dataset you want to use in multiple layers, as it saves you from specifying it for each layer.

## Data

The `data` argument mostly speaks for itself. It must be a `tibble` or a `data.frame`.

We will use the following two datasets for this vignette:
A simple one series time series dataset:
```{r}
simple_data <- data.frame(date = seq.Date(from = as.Date("2017-01-10"), length.out = 5, by = "quarter"), y1 = rnorm(5))
```

And a more complex dataset in long form, where we have observations for two variables `y1` and `y2` across 5 dates, for two different cross-sectional units (e.g. states) - `A` and `B`.
```{r}
long_data <- data.frame(date = rep(seq.Date(from = as.Date("2017-01-10"), length.out = 5, by = "quarter"), 2), y1 = rnorm(10), y2 = rnorm(10), group_var = c(rep("A", 5), rep("B", 5)))
```

## Aesthetic

An aesthetic is the definition of a layer. It specifies the `x` and `y` variables from your data.
```{r, results = "hide"}
p <- arphitgg() + 
  agg_line(data = simple_data, aes = agg_aes(x = date, y = y1))
agg_draw(p, filename = "no-group-aes.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("no-group-aes.png")
```

### Groups

An aesthetic can also specify a `group` variable. This is used when your data is in long form and you have multiple observations on each `x` observation, corresponding to different variables. For instance, `x` might be the date column, `y` the column containing observations of the unemployment rate and `group` the column containing state identifiers.
```{r, results = "hide"}
p <- arphitgg() +
  agg_line(data = long_data, aes = agg_aes(x = date, y = y1, group = group_var))
agg_draw(p, filename = "group-aes.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("group-aes.png")
```

## Layers

A layer is a series (or group of series) built from the same aesthetic. In `arphit`, layers must be assigned to a panel.

Layers take four arguments:
  1. Data
  2. Aesthetic
  3. Panel (defaults to "1" if not supplied)
  4. Colour (optional, and discussed below)

There are two types of layers, `agg_line` and `agg_col`. These are used nearly identically to produce line and column graphs respectively:
```{r, results = "hide"}
p <- arphitgg(layout = "2h") + 
  agg_line(data = long_data, aes = agg_aes(x = date, y = y1, group = group_var), panel = "1") + 
  agg_col(data = long_data, aes = agg_aes(x = date, y = y2, group = group_var), panel = "3")
agg_draw(p, filename = "layers.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layers.png")
```

Layers will inherit data and aesthetic (or parts of the aesthetic) if these are left null in the layer specification. This is handy to save you from having to repeat yourself:
```{r, results = "hide"}
p <- arphitgg(long_data, aes = agg_aes(x = date, group = group_var), layout = "2h") + 
  agg_line(aes = agg_aes(y = y1), panel = "1") + 
  agg_col(aes = agg_aes(y = y2), panel = "3")
agg_draw(p, filename = "inherit.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("inherit.png")
```

NB: column layers have an additional optional argument `stacked`, which determines whether the bars should be stacked or not.

# Series colours

Specifying colours for series is done when creating a layer. For instance:
```{r, results = "hide"}
p <- arphitgg() + 
  agg_line(data = simple_data, aes = agg_aes(x = date, y = y1), color = RBA["Red1"])
agg_draw(p, filename = "simplecolor.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("simplecolor.png")
```

This color is applied to _all_ series in the layer. This is less helpful when you have a group variable, since they will all show up as the same colour (which is unlikely to be what you want). E.g. this is not helpful:
```{r, results = "hide"}
p <- arphitgg() +
  agg_line(data = long_data, aes = agg_aes(x = date, y = y1, group = group_var), color = RBA["Red1"])
agg_draw(p, filename = "group-single-color.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("group-single-color.png")
```

To specify for different colours for different series in a grouped layer, you can instead specify a _vector_ of colours:
```{r, results = "hide"}
p <- arphitgg() +
  agg_line(data = long_data, aes = agg_aes(x = date, y = y1, group = group_var), color = c(RBA["Red1"], RBA["Blue4"]))
agg_draw(p, filename = "group-multi-color.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("group-multi-color.png")
```

(NB: `arphit` will cycle through the supplied vector colours if there aren't enough in the vector to cover the number of series in the layer.)

# Titles

Titles and subtitles are added using `agg_title` and `agg_subtitle` respectively. The only required argument is the text for the title/subtitle:
```{r results = "hide"}
p <- arphitgg() + agg_title("Graph Title Goes Here") + agg_subtitle("Or a subtitle, if you like")
agg_draw(p, filename = "title.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("title.png")
```

To add panel titles, specify a panel identifier in the `agg_title` or `agg_subtitle` call:
```{r results = "hide"}
p <- arphitgg() + agg_title("Graph Title Goes Here") + agg_subtitle("Or a subtitle, if you like") + 
  agg_title("And here is panel title", panel = "1") + agg_subtitle("Panel subtitle too if needed", panel = "1")
agg_draw(p, filename = "paneltitle.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("paneltitle.png")
```

# Units

You can specify the units for your graph using the `agg_units` function. This can be used either with or without a panel specifier. If called without a panel specifier, the units are applied to all panels, otherwise the units are added only to specified panel:
```{r results = "hide"}
p <- arphitgg() + agg_units("index")
agg_draw(p, filename = "units-all.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("units-all.png")
```

```{r results = "hide"}
p <- arphitgg() + agg_units("index", panel = "1") + agg_units("ppt", panel = "2")
agg_draw(p, filename = "units-specific.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("units-specific.png")
```

# Sources and footnotes

Adding sources and footnotes is done using `agg_source` and `agg_footnote`. You can pass in a single text string, or a vector of multiple strings. You can add as many `agg_source`/`agg_footnote` as you like:
```{r results = "hide"}
p <- arphitgg() + agg_source("Source 1") + agg_source(c("Source 2 (as a vector)", "Source 3 (vectors are easy!")) + 
  agg_footnote("This is my first footnoote") + agg_footnote("This is a second footnote")
agg_draw(p, filename = "sources.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("sources.png")
```

# Saving to a file

To save your graph to a file instead of displaying it, using `agg_draw` with the optional filename command. `arphit` will determine what file to save as, based on the extension of your filename. `png`, `emf` and `pdf` are supported.
```{r, results = "hide", eval = FALSE}
p <- arphitgg(simple_data, aes = agg_aes(x = date, y = y1))
agg_draw(p, filename = "my-graph.png")
```
