---
title: "Plotting options"
author: "Angus Moore"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This document outlines all of the plotting options in arphit.tsgraph and how to use them.
Examples are included of output, along with explanations.

The very first step to using `arphit` is to import it into your workspace:
```{r}
library(arphit)
```

If you get an error because you haven't yet installed `arphit`, see the 'Installation' section of the [README](https://github.com/angusmoore/arphit/blob/master/README.md).

## Data

The most important input to `arphit.tsgraph` is data. Your data must be a `ts` object.
You can convert a dataframe to a `ts` object very easily. For instance, suppose I have
quarterly data that starts in 2000Q1 in a data.frame called `foo`. I can convert it a `ts`
by calling:
```
foo_ts <- ts(foo, start = c(2000,1), frequency = 4)
```
For more details on the `ts` class see [https://stat.ethz.ch/R-manual/R-devel/library/stats/html/ts.html].

For the remainder of this vignette, we will use the following randomly constructed time
series for the examples:
```{r}
T <- 12
data <- ts(data.frame(x1 = rnorm(T), x2 = rnorm(T), x3 = rnorm(T, sd = 10), x4 = rnorm(T, sd = 5)), start = c(2000,1), frequency = 4)

```

## Panels, series and layouts

The `layout` options and the `series` options are closely related. `layout` determines the
layout of panels in your graph. `series` tells arphit which series to put on which panel.

ch layout has a number of panels where series can be placed. *Right hand side axes count as separate axes
in some layouts.* Panels are number from left to right, top to bottom.

The `series` argument must be passed as a list, with keys (as strings) corresponding to panel numbers
and values equal to vectors of series names. For instance, to plot series `x1` and `x2` from our example
on panel 1 amd series `x3` and `x4` on panel 2, we would need to use a list as follows:
```
list("1" = c("x1","x2"), "2" = c("x3","x4"))
```

There are four supported layouts:
  1. One-panel "1". This is the default if you do not supply a value for `layout`. Despite its name this layout
has *two* panels. Panel "1" corresponds to the left axis; panel "2" corresponds to the right axis.
Plotting series `x1` and `x4` on a one panel:
```
arphit.tsgraph(data, layout = "1", series = list("1" = c("x1","x4")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "1", series = list("1" = c("x1","x4")), filename = "layout_1.png")
```
<img src = "layout_1.png", width = "300">
  
  Of course, the standard deviation of `x4` is much larger than `x1`, so this plot is not very easy to look
at. Instead, we could plot `x1` on the left axis and `x4` on the right by doing:
```
arphit.tsgraph(data, layout = "1", series = list("1" = c("x1"), "2" = c("x4")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "1", series = list("1" = c("x1"), "2" = c("x4")), filename = "layout_1_LR.png")
```
<img src = "layout_1_LR.png", width = "300"> 

  2. Two-panel vertical "2v". This layout has two panels, divided vertically. Panel "1" is the left panel,
panel "2" the right. This example plots the series `x1` on the left panel and `x2` on the right.
```
arphit.tsgraph(data, layout = "2v", series = list("1" = c("x1"), "2" = c("x2")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2v", series = list("1" = c("x1"), "2" = c("x2")), filename = "layout_2v.png")
```
<img src = "layout_2v.png", width = "300"> 

  3. Two-panel horizontal "2h". This layout has *four* panels. Panels "1" and "2" are the left and
right axes of the top panel. "3" and "4" for the bottom. This example plots `x1` on panel the left axis of the top
panel and `x2` on the right, and likewise for `x3` and `x4` on the bottom.
```
arphit.tsgraph(data, layout = "2h", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2h", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), filename = "layout_2h.png")
```
<img src = "layout_2h.png", width = "300">
  
  As with the one panel, there is no need to use the right axis if it is not required. This example plots `x1` and
`x2` on the left axis of the top panel and `x3` and `x4` on the left axis of the bottom panel.
```
arphit.tsgraph(data, layout = "2h", series = list("1" = c("x1","x2"), "3" = c("x3","x4")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2h", series = list("1" = c("x1","x2"), "3" = c("x3","x4")), filename = "layout_2h_L.png")
```
<img src = "layout_2h_L.png", width = "300">
  
  4. Two-by-two "2b2". This layout is very similar to "2h", except the left and right panels are divided, rather
than axes.
```
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), filename = "layout_2b2.png")
```
<img src = "layout_2b2.png", width = "300">

The `series` argument is actually optional. If not supplied, *all* series in `data` will be plotted on panel "1".
This can be useful if you want a quick and dirty plot of just a few series.

```
arphit.tsgraph(data)
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, filename = "layout_default.png")
```
<img src = "layout_default.png", width = "300">

## Portrait size

If you want a larger, portrait size layout, simply pass in `portait = TRUE`. This works with any of the layouts.
```
arphit.tsgraph(data, portrait = TRUE)
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, portrait = TRUE, filename = "layout_portrait.png")
```
<img src = "layout_portrait.png", width = "300">

# Bar graphs

You can make any of your series display as bars instead of a line using the `bar` argument. This is simply a 
vector of series that should be bars. If you do not pass this argument (or pass in an empty `bar` argument, all
series will be plotted as series). Everything else is the same - i.e. which panel/axis is determined by the `series`
argument.

This example plots `x1` as a line on the left axis, `x3` as a line on the right axis and `x2` as bars on the left axis:
```
arphit.tsgraph(data, series = list("1" = c("x1","x2"), "2" = c("x3")), bars = c("x2"))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, series = list("1" = c("x1","x2"), "2" = c("x3")), bars = c("x2"), filename = "bars.png")
```
<img src = "bars.png", width = "300">

If you have multiple bar series on one panel, they automatically be stacked. This example plots `x1` and `x2` as
bars on the left axis.
```
arphit.tsgraph(data, series = list("1" = c("x1","x2")), bars = c("x1","x2"))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, series = list("1" = c("x1","x2")), bars = c("x1","x2"), filename = "bars_stacked.png")
```
<img src = "bars_stacked.png", width = "300">

NB: The automatic y-axis scale will often be wrong with stacked bar charts. You may need to manually overrule it.
See the section on axis limits below.

## Stacked bars

By default, `arphit` will stack the bars. If you want the bars to be beside instead, pass in `bar.stacked = FALSE`.
(Since I'm not passing in the `series` argument, all series in `data` will be plotted on panel "1").

```
arphit.tsgraph(data, bars = c("x1","x2"), bar.stacked = FALSE)
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, bars = c("x1","x2"), bar.stacked = FALSE, filename = "bar_beside.png")
```
<img src = "bar_beside.png", width = "300">

# Title and subtitle

The graph title and subtitle are set with the `title` and `subtitle` arguments respectively. These are optional,
and by default are blank (`= NULL`).
```
arphit.tsgraph(data, title = "Here is a Title", subtitle = "And a subtitle")
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, title = "Here is a Title", subtitle = "And a subtitle", filename = "title.png")
```
<img src = "title.png", width = "300">

`arphit` will attempt to insert line breaks as necessary, but may not be smart enough in all cases. You can
insert linebreaks yourself as necessary by using "\\n".

# Panel titles and subtitles

You can add titles and subtitles to panels using the `paneltitle` and `panelsubtitle` arguments. These are lists
of panel identifiers (e.g. "1") to strings. For example:
```
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), paneltitle = list("1" = "Panel 1", "2" = "Panel 2", "3" = "Panel 3", "4" = "Panel 4"))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), paneltitle = list("1" = "Panel 1", "2" = "Panel 2", "3" = "Panel 3", "4" = "Panel 4"), filename = "paneltitle.png")
```
<img src = "paneltitle.png", width = "300">

And likewise for panelsubtitle.

# Footnotes and sources

## Footnotes

Footnotes are specified using the `footnote` argument and are passed as a vector:
```
arphit.tsgraph(data, footnote = c("Footnote 1", "Footnote 2", "etc, this can go on for a while"))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, footnote = c("Footnote 1", "Footnote 2", "etc, this can go on for a while"), filename = "footnote.png")
```

<img src = "footnote.png", width = "300">

## Sources

Sources are handled very similarly to foonotes, using the `sources` argument. 
```
arphit.tsgraph(data, sources = c("RBA", "ABS", "someone else"))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, sources = c("RBA", "ABS", "someone else"), filename = "sources.png")
```
<img src = "sources.png", width = "300">

`arphit` will automatically pluralise if more than one source is given.

# Scale units

By default, `arphit` sets the scale units to %. You can set your own by passing in a list of panel identifiers
to strings (corresponding to the units). For instance:
```
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), scaleunits = list("1" = "index", "2" = "ppt", "3" = "$", "4" = "000s"))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), scaleunits = list("1" = "index", "2" = "ppt", "3" = "$", "4" = "000s"), filename = "units.png")
```
<img src = "units.png", width = "300">

# Line, bar and marker options

There are a number of fine-grained options for controlling the look of series. Each follows the same syntax, so
examples for just one is given.

Controlling these attributes is done using a list with keys equal to series names and values equal to whatever
attribute value is relevant. If a series is not included in the list, a sensible default value is given.

## Syntax and how to pass in values

This example gives an explicit colour to series `x2` and `x4`, but lets `arphit` use default values for
series `x1` and `x3`.
```
arphit.tsgraph(data, col = list("x2" = "pink", "x4" = "lightblue"))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, col = list("x2" = "pink", "x4" = "lightblue"), filename = "setcolours.png")
```
<img src = "setcolours.png", width = "300">

Alternatively, if you want to apply an attribute to *all* series, you can skip the list and just pass in the value.
For instance, this example sets all series to use `pch = 19`, which gives solid dots as markers.
```
arphit.tsgraph(data, pch = 19)
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, pch = 19, filename = "setattributeall.png")
```
<img src = "setattributeall.png", width = "300">

## Line colour

`col` controls the colour of your series. If a colour is not specified for a series, `arphit` cycles through the
default RBA colours. Any colour that R recognises can be given.

In future an RBA colour palette will be added to make it easy to use the RBA-approved colours by name.

## Line markers

`pch` allows you to add markers to your series. These directly follow the R options.

## Line type

`lty` allows you to control the line type - e.g. add dashing. These directly follow the R options.

## Line width

`lwd` controls the width of the line. 1 corresponds to default. 2 to twice default, 0.5 half it, etc.

## Bar outline

`barcol` lets you set the colour of the bar outline for any bar series. By default, this is `NA`, meaning no outline.

# Axis limits

## Y axis

`arphit` will automatically guess axes for each panel. However, it is not smart enough to sensibly line up axes across panels (e.g. if you have left and right axes). And stacked bar graphs will confuse it.

Y-limits are controlled by three variables: a minimum, a maximum, and the number of steps to include. These are passed as a list with `min`, `max` and `nsteps` keys - e.g. `list(min = -10,max = 10, nsteps = 5)`. Y-limits can be set for each panel using a list with entries for each panel, or can be applied uniformly to all panels.

### Example 1: Manually setting left and right axes
```
arphit.tsgraph(data, series = list("1" = c("x1"), "2" = c("x3")), ylim = list("1" = list(min = -10, max = 10, nsteps = 5), "2" = list(min = -20, max = 20, nsteps = 5)))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, series = list("1" = c("x1"), "2" = c("x3")), ylim = list("1" = list(min = -10, max = 10, nsteps = 5), "2" = list(min = -20, max = 20, nsteps = 5)), filename = "y-individual.png")
```
<img src = "y-individual.png", width = "300">

### Example 2: Applying the same y axis to all panels
```
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), ylim = list(min = -10, max = 10, nsteps = 5))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), ylim = list(min = -10, max = 10, nsteps = 5), filename = "y-uniform.png")
```
<img src = "y-uniform.png", width = "300">

## X axis

X-limits are controlled similar to y-limits. However, only a minimum and maximum (in years) is required. You can use
part years if desired by adding decimal places (e.g. `2000.5`). As with the y-axis you can provide a list giving `c(minimum,maximum)` pairs for each panel, or just pass a single pair to apply to all panels. The latter method is strongly recommended - there are not many cases where you need different x-axes for different panels.

Fine-grained control of x-ticks is not currently possible; only the limits can be set, the ticks are determined
automatically.

# Shading between series

You can shade the area between series by using the `shading` argument. This takes a list of lists. Each of the sublists must have keys `from`, `to` and `color`, which speak for themselves. You can supply multiple sets of shading (hence the list of lists). They are drawn first to last, so if you want to shade over the top, supply bottom to top. All series are _always_ drawn on top of shading.

```
arphit.tsgraph(data, shading = list(list(from = "x1", to = "x2", color= "red")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, shading = list(list(from = "x1", to = "x2", color= "red")), filename = "shading.png")
```
<img src = "shading.png", width = "300">

```
arphit.tsgraph(data, shading = list(list(from = "x1", to = "x2", color= "red")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, shading = list(list(from = "x1", to = "x2", color= "red"), list(from = "x3", to = "x4", color = "purple")), filename = "shading-layered.png")
```
<img src = "shading-layered.png", width = "300">

# Plot annotations

## Adding labels and arrows

You can add series labels, and arrow to aid those labels, using the `labels` and `arrows` arguments.

Labels are specified as a list of lists. Each sub-list specifies a single text label. These must be of the form: `list(x = 2008, y = -1, text = "Label text", panel = 1, color = "black")`. Where `x` and `y` specify where (in the units on the plot) the centre of the label should be. `panel` specifies which panel to place the label on. `color` is self-explanatory. You can add line breaks in text using the `\n` character.

```
arphit.tsgraph(data, labels = list(list(x = 2001, y = 2, text = "A label", panel = 1, color = "red"), list(x = 2004, y = 10, text = "A label\n(On two lines!)", panel = 1, color = "green")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, labels = list(list(x = 2001, y = 2, text = "A label", panel = 1, color = "red"), list(x = 2002, y = 10, text = "A label\n(On two lines!)", panel = 1, color = "green")), filename = "labels.png")
```
<img src = "labels.png", width = "300">

Arrows are specified similarly. You pass in a list of lists specifying arrows to add to the plot Each sub-list specifies a single arrow. These must be of the form: `list(tail.x = 2000, tail.y = -1, head.x = 2001, head.y = 0, panel = 1, lwd = 1, color = "black")`. `tail.x` and `tail.y` specify the coordinates (in the units on the plot) of where to start the arrow at, `head.x` and `head.y` where to finish it. panel specifies which panel to place the arrow on. `color` is self-explanatory. `lwd` is optional and specifies the linewidth of the arrow (default = 1).

```
arphit.tsgraph(data, arrows = list(list(tail.x = 2000, tail.y = 10, head.x = 2001, head.y = 1, color = "darkred", panel = 1)))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, arrows = list(list(tail.x = 2000, tail.y = 10, head.x = 2001, head.y = 1, color = "darkred", panel = 1)), filename = "arrows.png")
```
<img src = "arrows.png", width = "300">

## Adding horizonal and vertical lines

A list of lists specifying line segments to add to the plot. Each of the sublists specifies a single line segment to add. These can be specified in three ways. The most common way is specifying either a horizontal or vertical line that stretches across the panel. Do this by having a sublist entry similar to `list(x = 2001, panel = 1, color = "green", lty = 1)`. `x` is where, on the x-axis, the line will be drawn. `panel` specifies which panel to draw on. `color` is self-explanatory and is optional (default black). `lty` specifies what line type to use (see R lty options) - it is optional and defaults to 1 (solid). To draw a horizontal line use use y instead of x.

The following example draws a vertical line at 2001 using the default colour and solid line. It also draws a horizontal line at -1 colored darkred and dashed (`lty = 2`).

```
arphit.tsgraph(data, lines = list(list(x = 2001, panel = 1), list(y = -1, color = "darkred", panel = 1, lty = 2)))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, lines = list(list(x = 2001, panel = 1), list(y = -1, color = "darkred", panel = 1, lty = 2)), filename = "lines.png")
```
<img src = "lines.png", width = "300">

If you want more control, you can specify the coordinates of the line segment instead of using `x` or `y`.  To do so use `list(x1 = 2000, y1 = -1, x2 = 2001, y2 = 0, panel = 1)` instead of x and y. All other options are the same. For example:

```
arphit.tsgraph(data, lines = list(list(x1 = 2000, y1 = -10, x2 = 2002, y2 = 5, panel = 1)))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, lines = list(list(x1 = 2000, y1 = -10, x2 = 2002, y2 = 5, panel = 1)), filename = "specificlines.png")
```
<img src = "specificlines.png", width = "300">

Entering NA for any of `x1`, `y1`, `x2`, or `y2` will set that coordinate to the axis limit (with `x1` and `y1` going to the left and bottom axes and `x2` and `y2` to the right and top).

## Adding background shading

Background shading can be added using the `bgshading` argument. This is a list of lists specifying background shading to add to the plot. Each of the sublists corresponds to a rectangle of background shading to draw. Each must be of the form: `list(x1 = NA, y1 = -1, x2 = NA, y2 = 1, panel = 1, color = "lightgrey")`. `x1` and `x2` correspond to the bottom left corner; `x2`, `y2` the top right. Passing NA will set that coordinate to the axis limit - this is useful for creating shading that stretches across a whole panel. `color` and `panel` are self-explanatory (color is optional and defaults to light grey).

This example creates horizontal shading across the whole panel between -1 and 3 on the y axis.

```
arphit.tsgraph(data, bgshading = list(list(x1 = NA, y1 = -1, x2 = NA, y2 = 3, panel = 1)))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, bgshading = list(list(x1 = NA, y1 = -1, x2 = NA, y2 = 3, panel = 1)), filename = "shading1.png")
```
<img src = "shading1.png", width = "300">

And this two panel example repeats the above example for panel 1, but puts light green shading between two dates on the bottom panel..

```
arphit.tsgraph(data, layout = "2h", series = list("1" = "x4", "3" = "x2"), bgshading = list(list(x1 = NA, y1 = -1, x2 = NA, y2 = 3, panel = 1), list(x1 = 2000.5, y1 = NA, x2 = 2001.5, y2 = NA, panel = 3, color = "lightgreen")))
```
```{r, echo = FALSE, results = "hide"}
arphit.tsgraph(data, layout = "2h", series = list("1" = "x4", "3" = "x2"), bgshading = list(list(x1 = NA, y1 = -1, x2 = NA, y2 = 3, panel = 1), list(x1 = 2000.5, y1 = NA, x2 = 2001.5, y2 = NA, panel = 3, color = "lightgreen")), filename = "shading2.png")
```
<img src = "shading2.png", width = "300">

# Saving your graph

By default, arphit uses R's default graphics device (`dev.new()`). This is only marginally useful, because
you'll probably want to include your graphs in word etc.

You can export your files automatically by using the `filename` argument. This will draw your graph straight
to that file *instead* of displaying it.
```
arphit.tsgraph(data, filename = "my_filename.png")
```

There are three supported file extensions: PNG, EMF and PDF. Simply include the relevant extension (lower case only)
in the filename and `arphit` will figure it out.
```
arphit.tsgraph(data, filename = "my_filename.png")
arphit.tsgraph(data, filename = "my_filename.emf")
arphit.tsgraph(data, filename = "my_filename.pdf")
```

