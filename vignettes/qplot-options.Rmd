---
title: "qplot plotting options"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    theme: united
    toc_float: true
vignette: >
  %\VignetteIndexEntry{qplot-options}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Quick links

 - [Index](index.html)
 - [Getting started](getting-started.html)
 - [Plotting options](plotting-options.html)
 - [Colour palette](rba-colours.html)
 - [Package documentation (pdf)](https://angusmoore.github.io/arphit/arphit.pdf)

# Introduction

This document outlines all of the plotting options in `agg_qplot` and how to use them.
Examples are included of output, along with explanations.

A word of warning:`agg_qplot` is actually extremely feature-filled, despite being for quick plots. Any graph you can make in `arphit` can be made with a suitably complex call to `agg_qplot`. But, if you're graph is complex, you should use `arphitgg`. It's much easier to use (no lists of lists) and much easier to read the code.

# Data and types of graphs

The most important input to `arphit` is data.

Data can be a `tibble`, a `data.frame` or a `ts`. (For more details on the `ts` class see [https://stat.ethz.ch/R-manual/R-devel/library/stats/html/ts.html].)

Please note, unless otherwise specified, the examples in this vignette use the following randomly constructed time
series:
```{r}
data <- ts(data.frame(x1 = rnorm(12),
                      x2 = rnorm(12),
                      x3 = rnorm(12, sd = 10),
                      x4 = rnorm(12, sd = 5)),
           start = c(2000,1),
           frequency = 4)
```

## Specifying data

The data is the first argument to an `agg_qplot` call. Calling `agg_qplot` is as simple as:
```{r, eval = FALSE}
agg_qplot(data)
```
```{r, echo = FALSE, results = "hide"}
library(arphit)
agg_qplot(data, filename = "data_1.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("data_1.png")
```

## Types of graphs and data

### Time series

Giving `arphit` a `ts` object will automatically produce a time series plot:
```{r, eval = FALSE}
mytsdata <- ts(data.frame(x1 = rnorm(10)), frequency = 4, start = c(2000, 1))
agg_qplot(mytsdata)
```
```{r, echo = FALSE, results = "hide"}
mytsdata <- ts(data.frame(x1 = rnorm(10)), frequency = 4, start = c(2000, 1))
agg_qplot(mytsdata, filename = "data_ts.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("data_ts.png")
```

Alternatively if you have a `data.frame` or `tibble` with a date column, specify that as the x-variable:
```{r, eval = FALSE}
mydataframe <- data.frame(date = seq.Date(from = as.Date("2000-01-01"),
                                          length.out = 10, by = "quarter"),
                          x1 = rnorm(10))
agg_qplot(mydataframe, x = "date")
```
```{r, echo = FALSE, results = "hide"}
mydataframe <- data.frame(date = seq.Date(from = as.Date("2000-01-01"), length.out = 10, by = "quarter"), x1 = rnorm(10))
agg_qplot(mydataframe, x = "date", filename = "data_df.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("data_df.png")
```

### Undated and scatter graphs

Categorical data can be plotted by giving `arphit` the x variable that corresponds to the categories. For instance:
```{r, eval = FALSE}
categoricaldata <- data.frame(categoryname = letters[1:5], value = rnorm(5))
agg_qplot(categoricaldata, x = "categoryname")
```
```{r, echo = FALSE, results = "hide"}
categoricaldata <- data.frame(categoryname = letters[1:5], value = rnorm(5))
agg_qplot(categoricaldata, x = "categoryname", filename = "data_categorical.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("data_categorical.png")
```

This also works if you have numerical categories (but they have to be evenly spaced, otherwise `arphit` will assume you want a scatter graph.

Scatter plots work exactly the same. `arphit` will figure out if your x data are not categorical and plot a scatter graph instead:
```{r, eval = FALSE}
scatterdata <- data.frame(x = rnorm(20), y = rnorm(20))
agg_qplot(scatterdata, x = "x")
```
```{r, echo = FALSE, results = "hide"}
scatterdata <- data.frame(x = rnorm(20), y = rnorm(20))
agg_qplot(scatterdata, x = "x", filename = "data_scatter.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("data_scatter.png")
```

Only simple scatter plots are supported. You can specify only one x variable (though you can have multiple y variables) per panel.

### (Advanced) Different data and different x variables for different panels

You can also specify different datasets for different panels using a list, with keys corresponding to panel names. For instance, if you have two datasets, `data1` and `data2`, you could give them to `arphit` to plot on panels 1 and 2 as follows:
```{r, eval = FALSE}
agg_qplot(list("1" = data1, "2" = data2))
```

(See below for a discussion of layouts and panels.)

It is also possible to specify different x variables for different panels (and, by extension, have different plot types in each panel). Simply specify your `x` as a list, with keys for each panel:
```{r, eval = FALSE}
data1 <- data.frame(date = seq.Date(from = as.Date("2000-01-01"),
                                    length.out = 10, by = "quarter"),
                    x1 = rnorm(10))
data2 <- data.frame(years = seq.Date(from = as.Date("2000-01-01"),
                                     length.out = 4, by = "year"),
                    x2 = rnorm(4))
agg_qplot(data = list("1" = data1, "2" = data2),
          x = list("1" = "date", "2" = "years"),
          layout = "2v")
```
```{r, echo = FALSE, results = "hide"}
data1 <- data.frame(date = seq.Date(from = as.Date("2000-01-01"),
                                    length.out = 10, by = "quarter"),
                    x1 = rnorm(10))
data2 <- data.frame(years = seq.Date(from = as.Date("2000-01-01"),
                                     length.out = 4, by = "year"),
                    x2 = rnorm(4))
agg_qplot(data = list("1" = data1, "2" = data2),
          x = list("1" = "date", "2" = "years"),
          layout = "2v", filename = "multidata.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("multidata.png")
```

This only makes sense to do if you are passing in different datasets for each panel. It is an error to try to pass different x values for only one dataset.

# Panels, series and layouts

The `layout` options and the `series` options are closely related. `layout` determines the
layout of panels in your graph. `series` tells arphit which series to put on which panel.

Each layout has a number of panels where series can be placed. *Right hand side axes count as separate panels in some layouts.* Panels are numbered from left to right, top to bottom.

The `series` argument must be passed as a list, with keys (as strings) corresponding to panel numbers and values equal to vectors of series names. For instance, to plot series `x1` and `x2` from our example on panel 1 amd series `x3` and `x4` on panel 2, we would need to use a list as follows:
```{r, eval = FALSE}
list("1" = c("x1","x2"), "2" = c("x3","x4"))
```

There are nine supported layouts:

  1. One-panel "1". This is the default if you do not supply a value for `layout`. Despite its name this layout has *two* panels. Panel "1" corresponds to the left axis; panel "2" corresponds to the right axis.
Plotting series `x1` and `x4` on a one panel:
```{r, eval = FALSE}
agg_qplot(data, layout = "1", series = list("1" = c("x1","x4")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "1", series = list("1" = c("x1","x4")), filename = "layout_1.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_1.png")
```

  Of course, the standard deviation of `x4` is much larger than `x1`, so this plot is not very easy to look
at. Instead, we could plot `x1` on the left axis and `x4` on the right by doing:
```{r, eval = FALSE}
agg_qplot(data, layout = "1", series = list("1" = c("x1"), "2" = c("x4")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "1", series = list("1" = c("x1"), "2" = c("x4")), filename = "layout_1_LR.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_1_LR.png")
```

  2. Two-panel vertical "2v". This layout has two panels, divided vertically. Panel "1" is the left panel, panel "2" the right. This example plots the series `x1` on the left panel and `x2` on the right.
```{r, eval = FALSE}
agg_qplot(data, layout = "2v", series = list("1" = c("x1"), "2" = c("x2")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "2v", series = list("1" = c("x1"), "2" = c("x2")), filename = "layout_2v.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_2v.png")
```

  3. Two-panel horizontal "2h". This layout has *four* panels. Panels "1" and "2" are the left and right axes of the top panel. "3" and "4" for the bottom. This example plots `x1` on panel the left axis of the top panel and `x2` on the right, and likewise for `x3` and `x4` on the bottom.
```{r, eval = FALSE}
agg_qplot(data, layout = "2h", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "2h", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), filename = "layout_2h.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_2h.png")
```
  
  As with the one panel, there is no need to use the right axis if it is not required. This example plots `x1` and
`x2` on the left axis of the top panel and `x3` and `x4` on the left axis of the bottom panel.
```{r, eval = FALSE}
agg_qplot(data, layout = "2h", series = list("1" = c("x1","x2"), "3" = c("x3","x4")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "2h", series = list("1" = c("x1","x2"), "3" = c("x3","x4")), filename = "layout_2h_L.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_2h_L.png")
```
  
  4. Two-by-two "2b2". This layout is very similar to "2h", except the left and right panels are divided, rather than axes.
```{r, eval = FALSE}
agg_qplot(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), filename = "layout_2b2.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_2b2.png")
```

  5. Three panel vertical "3v":
```{r, eval = FALSE}
agg_qplot(data, layout = "3v", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "3v", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3")), filename = "layout_3v.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_3v.png")
```  

  6. Three panel horizontal "3h" (has left and right axes, like "2h"):
```{r, eval = FALSE}
agg_qplot(data, layout = "3h", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x1"), "5" = "x1"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "3h", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x1"), "5" = "x1"), filename = "layout_3h.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_3h.png")
```  

  7. Six panel three-by-two "3b2":
```{r, eval = FALSE}
agg_qplot(data, layout = "3b2", series = list("1" = "x1", "2" = "x2", "3" = "x1", "4" = "x2", "5" = "x1", "6" = "x4"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "3b2", series = list("1" = "x1", "2" = "x2", "3" = "x1", "4" = "x2", "5" = "x1", "6" = "x4"), filename = "layout_3b2.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_3b2.png")
```  

  8. Four panel horizontal "4h" (has left and right axes like "2h"):
```{r, eval = FALSE}
agg_qplot(data, layout = "4h", series = list("1" = "x1", "2" = "x2", "3" = "x1", "4" = "x2", "5" = "x1", "6" = "x4", "7" = "x2", "8" = c("x1","x2")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "4h", series = list("1" = "x1", "2" = "x2", "3" = "x1", "4" = "x2", "5" = "x1", "6" = "x4", "7" = "x2", "8" = c("x1","x2")), filename = "layout_4h.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_4h.png")
```

  9. Eight panel four-by-two "4b2":
```{r, eval = FALSE}
agg_qplot(data, layout = "4b2", series = list("1" = "x1", "2" = "x2", "3" = "x1", "4" = "x2", "5" = "x1", "6" = "x4", "7" = "x2", "8" = c("x1","x2")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "4b2", series = list("1" = "x1", "2" = "x2", "3" = "x1", "4" = "x2", "5" = "x1", "6" = "x4", "7" = "x2", "8" = c("x1","x2")), filename = "layout_4b2.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_4b2.png")
```

The `series` argument is actually optional. If not supplied, *all* series in `data` will be plotted on panel "1". This can be useful if you want a quick plot of just a few series.

```{r, eval = FALSE}
agg_qplot(data)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, filename = "layout_default.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_default.png")
```

## Portrait size

If you want a larger, portrait size layout, simply pass in `portait = TRUE`. This works with any of the layouts.
```{r, eval = FALSE}
agg_qplot(data, portrait = TRUE)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, portrait = TRUE, filename = "layout_portrait.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("layout_portrait.png")
```

## (Advanced) Custom graph sizes

You can also manually specify the plot size if you want greater control. This size is for the *whole* graph - i.e. the size of the graph, not the size of a panel. Units are inches (the graphs have been scaled to half original size when included in this document).
```{r, eval = FALSE}
agg_qplot(data, plotsize = c(2,10))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, plotsize = c(2,10), filename = "plotsize.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("plotsize.png")
```

# Bar graphs

You can make any of your series display as bars instead of a line using the `bar` argument. This is simply a vector of series that should be bars. If you do not pass this argument (or pass in an empty `bar` argument, all  will be plotted as series). Everything else is the same - i.e. which panel/axis is determined by the `series` argument.

This example plots `x1` as a line on the left axis, `x3` as a line on the right axis and `x2` as bars on the left axis:
```{r, eval = FALSE}
agg_qplot(data, series = list("1" = c("x1","x2"), "2" = c("x3")), bars = c("x2"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, series = list("1" = c("x1","x2"), "2" = c("x3")), bars = c("x2"), filename = "bars.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("bars.png")
```

Alternatively, if you want all series to be bars, just set `bars = TRUE`. This is equivalent to passing in a vector with all series names.

## Stacked bars

If you have multiple bar series on one panel, they will automatically be stacked. This example plots `x1` and `x2` as bars on the left axis.
```{r, eval = FALSE}
agg_qplot(data, series = list("1" = c("x1","x2")), bars = c("x1","x2"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, series = list("1" = c("x1","x2")), bars = c("x1","x2"), filename = "bars_stacked.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("bars_stacked.png")
```

NB: The automatic y-axis scale will often be wrong with stacked bar charts. You may need to manually overrule it. See the section on axis limits below.

If you want the bars to be beside instead, pass in `bar.stacked = FALSE`. (Since I'm not passing in the `series` argument, all series in `data` will be plotted on panel "1").

```{r, eval = FALSE}
agg_qplot(data, bars = c("x1","x2"), bar.stacked = FALSE)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, bars = c("x1","x2"), bar.stacked = FALSE, filename = "bar_beside.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("bar_beside.png")
```

## (Advanced) Fine control over bars

If you need very fine control over which series are bars (for instance, if you have series with the same names in different panels), you can instead supply a list. The keys are the panel identifiers and the values are vectors of series.

# Title and subtitle

The graph title and subtitle are set with the `title` and `subtitle` arguments respectively. These are optional, and by default are blank (`= NULL`).
```{r, eval = FALSE}
agg_qplot(data, title = "Here is a Title", subtitle = "And a subtitle")
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, title = "Here is a Title", subtitle = "And a subtitle", filename = "title.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("title.png")
```

`arphit` will attempt to insert line breaks as necessary, but may not be smart enough in all cases. You can insert linebreaks yourself as necessary by using "\\n".
```{r, eval = FALSE}
agg_qplot(data, title = "Here is a very very very long title that arphit will automatically put a break in", subtitle = "And a subtitle\nwith a break too")
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, title = "Here is a very very very long title that arphit will automatically put a break in", subtitle = "And a subtitle\nwith a break too", filename = "longtitle.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("longtitle.png")
```

# Panel titles and subtitles

You can add titles and subtitles to panels using the `paneltitle` and `panelsubtitle` arguments. These are lists of panel identifiers (e.g. "1") to strings. For example:
```{r, eval = FALSE}
agg_qplot(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), paneltitle = list("1" = "Panel 1", "2" = "Panel 2", "3" = "Panel 3", "4" = "Panel 4"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "2b2", series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")), paneltitle = list("1" = "Panel 1", "2" = "Panel 2", "3" = "Panel 3", "4" = "Panel 4"), filename = "paneltitle.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("paneltitle.png")
```

And likewise for panelsubtitle.

`arphit` will attempt to insert line breaks as necessary, but may not be smart enough in all cases. You can insert linebreaks yourself as necessary by using "\\n".

# Footnotes and sources

## Footnotes

Footnotes are specified using the `footnote` argument and are passed as a vector:
```{r, eval = FALSE}
agg_qplot(data, footnote = c("Footnote 1", "Footnote 2", "etc, this can go on for a while"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, footnote = c("Footnote 1", "Footnote 2", "etc, this can go on for a while"), filename = "footnote.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("footnote.png")
```

## Sources

Sources are handled very similarly to foonotes, using the `sources` argument. 
```{r, eval = FALSE}
agg_qplot(data, sources = c("RBA", "ABS", "someone else"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, sources = c("RBA", "ABS", "someone else"), filename = "sources.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("sources.png")
```

`arphit` will automatically pluralise if more than one source is given.

# Y axis units

By default, `arphit` sets the y axis units to %. You can set your own by passing in a list of panel identifiers to strings (corresponding to the units). For instance:
```{r, eval = FALSE}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          yunits = list("1" = "index", "2" = "ppt", "3" = "$", "4" = "000s"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          yunits = list("1" = "index", "2" = "ppt", "3" = "$", "4" = "000s"),
          filename = "units.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("units.png")
```

If you want the same units for all panels, you can just pass in the string, instead of a list:
```{r, eval = FALSE}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          yunits = "000s")
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          yunits = "000s",
          filename = "units-all.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("units-all.png")
```

## x-axis units

You can also add units for the x-axis in much the same way. These are ignored for anything other than scatter graphs.

```{r, eval = FALSE}
scatterdata <- data.frame(x = rnorm(20), y = rnorm(20))
agg_qplot(scatterdata, x = "x", xunits = "ppt")
```
```{r, echo = FALSE, results = "hide"}
scatterdata <- data.frame(x = rnorm(20), y = rnorm(20))
agg_qplot(scatterdata, x = "x", xunits = "ppt", filename = "x-units.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("x-units.png")
```

# Line, bar and marker options

There are a number of fine-grained options for controlling the look of series. Each follows the same syntax, so examples for just a few are given.

Controlling these attributes is done using a list with keys equal to series names and values equal to whatever attribute value is relevant. If a series is not included in the list, a sensible default value is given.

## Syntax and how to pass in values

This example gives an explicit colour to series `x2` and `x4`, but lets `arphit` use default values for series `x1` and `x3`.
```{r, eval = FALSE}
agg_qplot(data, col = list("x2" = "pink", "x4" = "lightblue"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, col = list("x2" = "pink", "x4" = "lightblue"), filename = "setcolours.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("setcolours.png")
```

Alternatively, if you want to apply an attribute to *all* series, you can skip the list and just pass in the value.

For instance, this example sets all series to use `pch = 19`, which gives solid dots as markers.
```{r, eval = FALSE}
agg_qplot(data, pch = 19)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, pch = 19, filename = "setattributeall.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("setattributeall.png")
```

## Line colour

`col` controls the colour of your series. If a colour is not specified for a series, `arphit` cycles through default colours.

The color palette can be accessed using `RBA["Green1"]` etc. For instance:
```{r, eval = FALSE}
agg_qplot(data,
          series = list("1" = c("x2", "x4")),
          col = list("x2" = RBA["Red1"], "x4" = RBA["Blue10"]))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          series = list("1" = c("x2", "x4")),
          col = list("x2" = RBA["Red1"], "x4" = RBA["Blue10"]),
          filename = "rbacolours.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("rbacolours.png")
```

To see the full list of availble colours type `vignette("rba-colours", package = "arphit")`.

Alternatively, you can use any colour that R recognises.

## Line markers

`pch` allows you to add markers to your series. These directly follow the R options.

## Line type

`lty` allows you to control the line type - e.g. add dashing. These directly follow the R options.

## Line width

`lwd` controls the width of the line. 1 corresponds to default. 2 to twice default, 0.5 half it, etc.

## Bar outline

`barcol` lets you set the colour of the bar outline for any bar series. By default, this is `NA`, meaning no outline.

## (Advanced) Finer grain control

If you need finer grain control (for instance, you have series with same name in different panels), you can specify panel identifiers for attributes. This just requires you to place the attribute list within another list that has panel identifiers as keys (and the list of series to attribute values as the value).

# Axis limits

## Y axis

`arphit` will automatically guess axes for each panel. However, it is not smart enough to sensibly line up axes across panels (e.g. if you have left and right axes). And stacked bar graphs will confuse it.

Y-limits are controlled by three variables: a minimum, a maximum, and the number of steps to include. These are passed as a list with `min`, `max` and `nsteps` keys - e.g. `list(min = -10,max = 10, nsteps = 5)`. Y-limits can be set for each panel using a list with entries for each panel, or can be applied uniformly to all panels.

### Example 1: Manually setting left and right axes
```{r, eval = FALSE}
agg_qplot(data,
          series = list("1" = c("x1"), "2" = c("x3")),
          ylim = list("1" = list(min = -10, max = 10, nsteps = 5), 
                      "2" = list(min = -20, max = 20, nsteps = 5)))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          series = list("1" = c("x1"), "2" = c("x3")),
          ylim = list("1" = list(min = -10, max = 10, nsteps = 5), 
                      "2" = list(min = -20, max = 20, nsteps = 5)), filename = "y-individual.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("y-individual.png")
```

### Example 2: Applying the same y axis to all panels
```{r, eval = FALSE}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          ylim = list(min = -10, max = 10, nsteps = 5))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          ylim = list(min = -10, max = 10, nsteps = 5), filename = "y-uniform.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("y-uniform.png")
```

## X axis

X-limits are controlled similar to y-limits. However, only a minimum and maximum is required. For time series graphs, you can use part years if desired by adding decimal places (e.g. `2000.5`). As with the y-axis you can provide a list giving `c(minimum,maximum)` pairs for each panel, or just pass a single pair to apply to all panels. The latter method is strongly recommended - there are not many cases where you need different x-axes for different panels.

Fine-grained control of x-ticks is not currently possible; only the limits can be set, the ticks are determined automatically.

For layouts with vertical division (e.g. "2v", "2b2" etc), you can drop the the first tick of the right hand panel by setting `dropxlabel = TRUE`. This prevents the last label of the left hand panel overlapping the first of the right hand panel.

```{r, eval = FALSE}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          dropxlabel = TRUE)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          layout = "2b2",
          series = list("1" = c("x1"), "2" = c("x2"), "3" = c("x3"), "4" = c("x4")),
          dropxlabel = TRUE,
          filename = "dropxlabel.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("dropxlabel.png")
```

# Shading between series

You can shade the area between series by using the `shading` argument. This takes a list of lists. Each of the sublists must have keys `from`, `to` and `color`, which speak for themselves. You can supply multiple sets of shading (hence the list of lists). They are drawn first to last, so if you want to shade over the top, supply bottom to top. All series are _always_ drawn on top of shading.
```{r, eval = FALSE}
agg_qplot(data, shading = list(list(from = "x1", to = "x2", color= "red")))
```
```{r, echo = FALSE, results = "hide", warning =  FALSE, message = FALSE}
agg_qplot(data, shading = list(list(from = "x1", to = "x2", color= "red")), filename = "shading.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("shading.png")
```

If you want to have more than one set of shading, just have multiple elements in the shading list.
```{r, eval = FALSE}
agg_qplot(data,
          shading = list(list(from = "x1", to = "x2", color= "red"),
                         list(from = "x3", to = "x4", color = "purple")))
```
```{r, echo = FALSE, results = "hide", warning =  FALSE, message = FALSE}
agg_qplot(data,
          shading = list(list(from = "x1", to = "x2", color= "red"),
                         list(from = "x3", to = "x4", color = "purple")),
          filename = "shading-layered.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("shading-layered.png")
```

# Plot annotations

## Adding labels and arrows

You can add series labels, and arrows to aid those labels, using the `labels` and `arrows` arguments.

Labels are specified as a list of lists. Each sub-list specifies a single text label. These must be of the form: `list(x = 2008, y = -1, text = "Label text", panel = 1, color = "black")`. Where `x` and `y` specify where (in the units on the plot) the centre of the label should be. `panel` specifies which panel to place the label on. `color` is self-explanatory. You can add line breaks in text using the `\n` character.
```{r, eval = FALSE}
agg_qplot(data,
          labels = list(list(x = 2001, y = 2, text = "A label",
                             panel = 1, color = "red"),
                        list(x = 2004, y = 10, text = "A label\n(On two lines!)",
                             panel = 1, color = "green")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          labels = list(list(x = 2001, y = 2, text = "A label",
                             panel = 1, color = "red"),
                        list(x = 2004, y = 10, text = "A label\n(On two lines!)",
                             panel = 1, color = "green")),
          filename = "labels.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("labels.png")
```

Arrows are specified similarly. You pass in a list of lists specifying arrows to add to the plot Each sub-list specifies a single arrow. These must be of the form: `list(tail.x = 2000, tail.y = -1, head.x = 2001, head.y = 0, panel = 1, lwd = 1, color = "black")`. `tail.x` and `tail.y` specify the coordinates (in the units on the plot) of where to start the arrow at, `head.x` and `head.y` where to finish it. panel specifies which panel to place the arrow on. `color` is self-explanatory. `lwd` is optional and specifies the linewidth of the arrow (default = 1).
```{r, eval = FALSE}
agg_qplot(data,
          arrows = list(list(tail.x = 2000, tail.y = 10,
                             head.x = 2001, head.y = 1,
                             color = "darkred", panel = 1)))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          arrows = list(list(tail.x = 2000, tail.y = 10,
                             head.x = 2001, head.y = 1,
                             color = "darkred", panel = 1)),
          filename = "arrows.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("arrows.png")
```

## (Experimental) Automatic labels

`arphit` has (experimental) functionality to _automatically_ add series labels for you. You can  the auto labeller by setting `enable_autolabeller = TRUE`. If enabled, the auto labeller will run on panels with more than one series, and which do not already have text labels. If you manually set text labels for a panel, the auto labeller will skip that panel. It will also add arrows from the label to the series if necessary.

### Series names

The auto labeller will use whatever your series are called in the data `ts` object. You can see the names of your columns like so:
```{r}
colnames(data)
```

To set the first series name to something else try:
```
colnames(data)[1] <- "Series 1 name"
```
Or similarly for other series.

### Enabling the auto labeller

Call the auto labeller like so:
```
agg_qplot(data, enable_autolabeller = TRUE)
```
```{r, echo = FALSE, message=FALSE, results = "hide"}
agg_qplot(data, enable_autolabeller = TRUE, filename = "autolabel.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("autolabel.png")
```

If you put text labels on panel 2, that disables the auto labeller for that panel:
```
agg_qplot(data,
          series = list("1" = c("x1","x2"), "2" = c("x1","x2")),
          layout = "2v",
          labels = list(list(x = 2001, y = 2, text = "A label", panel = "2", color = "red")),
          enable_autolabeller = TRUE)
```
```{r, echo = FALSE, message=FALSE, results = "hide"}
agg_qplot(data,
          series = list("1" = c("x1","x2"), "2" = c("x1","x2")),
          layout = "2v",
          labels = list(list(x = 2001, y = 2, text = "A label", panel = "2", color = "red")),
          enable_autolabeller = TRUE,
          filename = "autolabel-disableone.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("autolabel-disableone.png")
```

### Caveats for the auto labeller
* The auto labeller can be _slow_, particularly if you have a lot of series. Be patient while it runs.
* There are no guarantees the auto labeller will be able to find labels for all series, particularly if you have many series.
* The auto labeller is random; each run will put the labels in a different location.

## Adding horizonal and vertical lines

A list of lists specifying line segments to add to the plot. Each of the sublists specifies a single line segment to add. These can be specified in three ways. The most common way is specifying either a horizontal or vertical line that stretches across the panel. Do this by having a sublist entry similar to `list(x = 2001, panel = 1, color = "green", lty = 1)`. `x` is where, on the x-axis, the line will be drawn. `panel` specifies which panel to draw on. `color` is self-explanatory and is optional (default black). `lty` specifies what line type to use (see R lty options) - it is optional and defaults to 1 (solid). To draw a horizontal line use y instead of x.

The following example draws a vertical line at 2001 using the default colour and solid line. It also draws a horizontal line at -1 colored darkred and dashed (`lty = 2`).
```{r, eval = FALSE}
agg_qplot(data,
          lines = list(list(x = 2001, panel = 1),
                       list(y = -1, color = "darkred", panel = 1, lty = 2)))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          lines = list(list(x = 2001, panel = 1),
                       list(y = -1, color = "darkred", panel = 1, lty = 2)),
          filename = "lines.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("lines.png")
```

If you want more control, you can specify the coordinates of the line segment instead of using `x` or `y`.  To do so use `list(x1 = 2000, y1 = -1, x2 = 2001, y2 = 0, panel = 1)` instead of x and y. All other options are the same. For example:
```{r, eval = FALSE}
agg_qplot(data, lines = list(list(x1 = 2000, y1 = -10, x2 = 2002, y2 = 5, panel = 1)))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, lines = list(list(x1 = 2000, y1 = -10, x2 = 2002, y2 = 5, panel = 1)), filename = "specificlines.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("specificlines.png")
```

Entering NA for any of `x1`, `y1`, `x2`, or `y2` will set that coordinate to the axis limit (with `x1` and `y1` going to the left and bottom axes and `x2` and `y2` to the right and top).

## Adding background shading

Background shading can be added using the `bgshading` argument. This is a list of lists specifying background shading to add to the plot. Each of the sublists corresponds to a rectangle of background shading to draw. Each must be of the form: `list(x1 = NA, y1 = -1, x2 = NA, y2 = 1, panel = 1, color = "lightgrey")`. `x1` and `x2` correspond to the bottom left corner; `x2`, `y2` the top right. Passing NA will set that coordinate to the axis limit - this is useful for creating shading that stretches across a whole panel. `color` and `panel` are self-explanatory (color is optional and defaults to light grey).

This example creates horizontal shading across the whole panel between -1 and 3 on the y axis.
```{r, eval = FALSE}
agg_qplot(data, bgshading = list(list(x1 = NA, y1 = -1, x2 = NA, y2 = 3, panel = 1)))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, bgshading = list(list(x1 = NA, y1 = -1, x2 = NA, y2 = 3, panel = 1)), filename = "shading1.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("shading1.png")
```

And this two panel example repeats the above example for panel 1, but puts light green shading between two dates on the bottom panel.
```{r, eval = FALSE}
agg_qplot(data,
          layout = "2h",
          series = list("1" = "x4", "3" = "x2"),
          bgshading = list(list(x1 = NA, y1 = -1,
                                x2 = NA, y2 = 3,
                                panel = 1),
                           list(x1 = 2000.5, y1 = NA,
                                x2 = 2001.5, y2 = NA,
                                panel = 3, color = "lightgreen")))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data,
          layout = "2h",
          series = list("1" = "x4", "3" = "x2"),
          bgshading = list(list(x1 = NA, y1 = -1,
                                x2 = NA, y2 = 3,
                                panel = 1),
                           list(x1 = 2000.5, y1 = NA,
                                x2 = 2001.5, y2 = NA,
                                panel = 3, color = "lightgreen")), filename = "shading2.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("shading2.png")
```

## Adding axis labels

You can add y and x axis labels to plots using the `yaxislabels` and `xaxislabels` arguments. These take a list (or, to apply the same label to all panels, a string) specifying the axis labels for each panel:

```{r, eval = FALSE}
agg_qplot(data, layout = "2b2",
          yaxislabels = "A y axis label",
          xaxislabels = "An x label")
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "2b2",
          yaxislabels = "A y axis label",
          xaxislabels = "An x label",
          filename = "oneaxislabel.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("oneaxislabel.png")
```

```{r, eval = FALSE}
agg_qplot(data, layout = "2b2",
          yaxislabels = list("1" = "Foo", "3" = "Bar"),
          xaxislabels = list("3" = "An x label", "4" = "Another x label"))
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, layout = "2b2",
          yaxislabels = list("1" = "Foo", "3" = "Bar"),
          xaxislabels = list("3" = "An x label", "4" = "Another x label"), filename = "differentaxislabel.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("differentaxislabel.png")
```

## Rotating x ticks

You can rotate x ticks using the `srt` option. It represents the rotation (in degrees):
```{r, eval = FALSE}
agg_qplot(categoricaldata, x = "categoryname", srt = 45)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(categoricaldata, x = "categoryname", srt = 45, filename = "xlabel-rotation.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("xlabel-rotation.png")
```

# Joining and missing values

The `joined` argument controls how your graph behaves with missing values. When `joined = TRUE` (which is the default) the series will ignore the missing value and connect to the next non-missing value. When `joined = FALSE` the series will break.

For instance, let's use this series, with the middle observation missing:
```{r}
joining_data <- ts(data.frame(y = c(1,2,NA,3,4)), start = 2000, frequency = 1)
```

With `joined = TRUE`, the series continues straight across the missing value for 2002.
```{r, eval = FALSE}
agg_qplot(joining_data, joined = TRUE)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(joining_data, joined = TRUE, filename = "joined.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("joined.png")
```

But when we set `joined = FALSE`, the series does not connect over the missing observation:
```{r, eval = FALSE}
agg_qplot(joining_data, joined = FALSE)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(joining_data, joined = FALSE, filename = "unjoined.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("unjoined.png")
```

# Adding a legend

You can add a legend to your graph by setting `legend = TRUE`. You can specify how many columns to have with `lengend.ncol`, but arphit will automatically guess otherwise.
```{r, eval = FALSE}
agg_qplot(data, legend = TRUE)
```
```{r, echo = FALSE, results = "hide"}
agg_qplot(data, legend = TRUE, filename = "legend.png")
```
```{r, out.width = "50%", echo = FALSE, fig.align="center"}
knitr::include_graphics("legend.png")
```

`arphit` will ignore duplicate series in multiple panels (i.e. it will only put in one legend entry).

# Saving your graph

By default, arphit uses R's default graphics device (`dev.new()`). This is only marginally useful, because you'll probably want to include your graphs in word etc.

You can export your files automatically by using the `filename` argument. This will draw your graph straight to that file *instead* of displaying it.
```{r, eval = FALSE}
agg_qplot(data, filename = "my_filename.png")
```

There are three supported file extensions: PNG, EMF and PDF. Simply include the relevant extension (lower case only) in the filename and `arphit` will figure it out.
```{r, eval = FALSE}
agg_qplot(data, filename = "my_filename.png")
agg_qplot(data, filename = "my_filename.emf")
agg_qplot(data, filename = "my_filename.pdf")
```
